---
title: Vale das Artes
---

import { Step, Steps } from 'fumadocs-ui/components/steps';

## Observa√ß√µes sobre o artigo
### Dada a incapacidade do grupo de se dedicar √† escrita do trabalho (uso de IA), sinto-me no direito de nem ao menos iniciar a leitura.


## Observa√ß√µes sobre o c√≥digo
<Steps>
    <Step>
        O cadastro do usu√°rio possui diversos campos que n√£o possuem valida√ß√£o.
        Al√©m disso, alguns campos, como o de `Estado` n√£o deveriam estar abertos ao usu√°rio,
        e sim com valores predefinidos que ele poderia escolher.
    </Step>
    <Step>
        No cadastro de usu√°rio, os campos deveriam possuir m√°scaras de input Ex.: XXX.XXX.XXX-XX.
    </Step>
    <Step>
        No perfil do usu√°rio, √© poss√≠vel salvar o usu√°rio com dados que deveriam ser inv√°lidos;
        - Nome: `    a        a        a `
        - Telefone: `     3     3    3`
        - Logradouro: `      a   a`
        - Cidade: ` a  a`
        - Bairro: `a   a`
        - Nova Senha: Espa√ßos em branco
        ![perfil](/bancas-integrador/vale-das-artes/perfil.png)
    </Step>
    <Step>
        No perfil do usu√°rio, n√£o √© poss√≠vel remover a foto ap√≥s o cadastro.
    </Step>
    <Step>
        √â poss√≠vel avaliar um produto infinitamente, mesmo que voc√™ seja o vendedor, e que n√£o tenha comprado o produto.
        Al√©m disso, n√£o √© poss√≠vel editar ou excluir uma avalia√ß√£o.
    </Step>
    <Step>
        No perfil de usu√°rio vendedor, a usabilidade √© descartada ao n√£o carregar o endere√ßo automaticamente com base no CEP.
    </Step>
    <Step>
        No perfil de usu√°rio vendedor, a pr√©-visualiza√ß√£o do perfil n√£o √© coerente com o perfil real do vendedor.
    </Step>
    <Step>
        No carrinho, o formul√°rio n√£o possui valida√ß√£o alguma, todos os campos podem ser enviados com espa√ßo em branco.
    </Step>
    <Step>
        O c√≥digo possui v√°rios sinais de uso de IA, como nos seguintes exemplos:
        ```java title="src/main/java/br/com/valedasartes/domain/artista/service/ArtistaService.java"
        // --- M√âTODO CORRIGIDO ---
        @Transactional
        public ArtistaResponseDTO atualizarEndereco(Long id, ArtistaEnderecoUpdateDTO dto) {
            Artista artista = artistaRepository.findById(id)
                .orElseThrow(() -> new RuntimeException("Artista n√£o encontrado"));

            Endereco endereco = artista.getEndereco();

            // Se n√£o existir endere√ßo, cria um novo e vincula
            if (endereco == null) {
                endereco = new Endereco();
                endereco.setArtista(artista);
                artista.setEndereco(endereco);
            }

            // Atualiza os campos
            endereco.setCep(dto.cep());
            endereco.setLogradouro(dto.logradouro());
            endereco.setComplemento(dto.complemento());
            endereco.setBairro(dto.bairro());
            endereco.setCidade(dto.cidade());

            // CORRE√á√ÉO 1: Usa dto.estado() para bater com o DTO novo
            endereco.setEstado(dto.estado());

            // CORRE√á√ÉO 2: Salva o telefone
            endereco.setTelefone(dto.telefone());

            // L√≥gica segura de convers√£o de N√∫mero (String -> Integer)
            if (dto.numero() != null && !dto.numero().trim().isEmpty()) {
                try {
                    // Remove caracteres n√£o num√©ricos (ex: "46A" vira "46")
                    String numeroLimpo = dto.numero().replaceAll("\\D", "");
                    if (!numeroLimpo.isEmpty()) {
                        endereco.setNumero(Integer.parseInt(numeroLimpo));
                    } else {
                        endereco.setNumero(0); // Se for s√≥ texto (ex: "S/N"), salva 0
                    }
                } catch (NumberFormatException e) {
                    endereco.setNumero(0);
                }
            } else {
                endereco.setNumero(null);
            }

            // Salva explicitamente
            artistaRepository.save(artista);

            return new ArtistaResponseDTO(artista);
        }
        ```

        ```java title="src/main/java/br/com/valedasartes/domain/auth/service/AuthService.java"
        public void solicitarRecuperacaoSenha(String cpf, String telefone) {

            Long usuarioId = null;
            String tipo = null;
            String nomeUsuario = "";

            Optional<Cliente> clienteOpt = clienteRepository.findByCpfAndTelefone(cpf, telefone);

            if (clienteOpt.isPresent()) {
                usuarioId = clienteOpt.get().getId();
                tipo = "CLIENTE";
                nomeUsuario = clienteOpt.get().getNome();
            } else {

                Optional<Artista> artistaOpt = artistaRepository.findByCpfAndTelefone(cpf, telefone);
                if (artistaOpt.isPresent()) {
                    usuarioId = artistaOpt.get().getId();
                    tipo = "ARTISTA";
                    nomeUsuario = artistaOpt.get().getNome();
                }
            }

            if (usuarioId != null) {
                String tokenUuid = UUID.randomUUID().toString();


                TokenRecuperacao novoToken = new TokenRecuperacao(
                    tokenUuid,
                    usuarioId,
                    tipo,
                    LocalDateTime.now().plusMinutes(30)
                );

                tokenRepository.save(novoToken);

                String link = "http://localhost:5500/redefinir-senha.html?token=" + tokenUuid;

                System.out.println("=================================================");
                System.out.println(">>> üîê RECUPERA√á√ÉO CONFIRMADA (CPF + TEL)");
                System.out.println(">>> Para: " + nomeUsuario);
                System.out.println(">>> Link WhatsApp: " + link);
                System.out.println("=================================================");
            } else {
                System.out.println("‚ö†Ô∏è Tentativa falha: CPF e Telefone n√£o conferem.");
                throw new RuntimeException("CPF ou Telefone incorretos.");
            }
        }
        ```

        ```java title="src/main/java/br/com/valedasartes/domain/carrinho/service/CarrinhoService.java"

        /**
         * --- M√âTODO CORRIGIDO ---
         * Agora ele busca um carrinho ativo, e S√ì cria um novo se n√£o existir.
         */
        @Transactional
        public Carrinho criarCarrinhoParaCliente(Long clienteId) {

            // 1. TENTA BUSCAR UM CARRINHO ATIVO
            Optional<Carrinho> carrinhoExistente = carrinhoRepository
                    .findByClienteIdAndStatus(clienteId, CarrinhoStatus.ATIVO);

            // 2. SE O CARRINHO EXISTE, APENAS RETORNA ELE
            if (carrinhoExistente.isPresent()) {
                return carrinhoExistente.get();
            }

            // 3. SE N√ÉO EXISTE, CRIA UM NOVO
            Cliente cliente = clienteRepository.findById(clienteId)
                    .orElseThrow(() -> new RuntimeException("Cliente n√£o encontrado!"));

            Carrinho carrinho = new Carrinho();
            carrinho.setCliente(cliente);
            carrinho.setDataCriacao(LocalDateTime.now());
            carrinho.setStatus(CarrinhoStatus.ATIVO);

            return carrinhoRepository.save(carrinho);
        }
        ```

        ```css title="src/main/resources/static/css/style-index.css"

        /* --- CARROSSEL (ATUALIZADO) --- */
        #destaques {
           margin-top: 30px; /* Ajuste a folga que voc√™ quer aqui */
            width: 100vw;
            position: relative;
            width: 100vw;
            position: relative;
            left: 50%;
            right: 50%;
            margin-left: -50vw;
            margin-right: -50vw;

            margin-bottom: 60px;
            border-radius: 0; /* Removi borda arredondada pois agora encosta na tela */
            overflow: hidden;
            background-color: #EAE4D8;
        }

        #destaques-carousel {
            width: 50%;
            height: 500px;
            background-color: #EAE4D8;
            margin: 0 auto; /* <--- ADICIONE ESTA LINHA PARA CENTRALIZAR */
        }
        ```

        ```js title="src/main/resources/static/js/dashboard-cliente.js"
        // --- Carga Inicial de Dados ---
        async function checkLoginAndLoadData() {
            const role = localStorage.getItem('userRole');
            const userId = getUserId();

            if (!getToken() || !userId || role !== 'ROLE_CLIENTE') {
                alert("Acesso negado. Por favor, fa√ßa o login.");
                localStorage.clear();
                window.location.href = 'login.html';
                return;
            }

            try {
                const cliente = await apiClient(`/clientes/${userId}`, 'GET');

                // --- L√ìGICA DO HEADER IGUAL AO ARTES√ÉO ---
                if (cliente.nome) localStorage.setItem('userName', cliente.nome);
                if (cliente.fotoUrl) localStorage.setItem('userPhoto', cliente.fotoUrl);

                // Atualiza avatar do header se existir
                const headerAvatar = document.getElementById('nav-user-avatar');
                if (headerAvatar && cliente.fotoUrl) {
                    headerAvatar.src = `${cliente.fotoUrl}?t=${new Date().getTime()}`;
                }
                // ------------------------------------------

                populatePage(cliente);
            } catch (error) {
                console.error("Erro ao buscar dados:", error);
            }
        }
        ```

        ```js title="src/main/resources/static/js/produto-detalhe.js"
        async function enviarAvaliacao(e) {
            e.preventDefault();

            const token = localStorage.getItem('userToken');
            const userId = localStorage.getItem('userId');

            // PEGA O NOME QUE EST√Å SALVO NO MOMENTO DO LOGIN
            // Se estiver "Sheva" aqui, √© porque voc√™ precisa deslogar e logar de novo.
            const nomeUsuarioLogado = localStorage.getItem('userName');

            console.log("Tentando enviar avalia√ß√£o como:", nomeUsuarioLogado); // <--- OLHE O CONSOLE (F12)

            if (!token || !userId) {
                alert("Fa√ßa login para avaliar.");
                window.location.href = 'login.html';
                return;
            }

            const notaInput = document.getElementById('nota-avaliacao');
            const comentarioInput = document.getElementById('comentario-avaliacao');

            const dto = {
                nota: parseFloat(notaInput.value),
                comentario: comentarioInput.value,
                produtoId: parseInt(produtoId),
                clienteId: parseInt(userId),
                // AQUI EST√Å O PULO DO GATO: Enviamos o nome que pegamos do localStorage
                nomeCliente: nomeUsuarioLogado
            };

            try {
                const res = await fetch(`${API_BASE_URL}/avaliacoes`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
                    body: JSON.stringify(dto)
                });

                if (res.ok) {
                    alert("Avalia√ß√£o enviada!");
                    comentarioInput.value = '';
                    carregarAvaliacoes();
                } else {
                    const erroData = await res.json().catch(() => ({}));
                    alert("Erro ao enviar avalia√ß√£o: " + (erroData.message || "Tente novamente"));
                }
            } catch (error) {
                console.error(error);
                alert("Erro de conex√£o.");
            }
        }
        ```
    </Step>
</Steps>
